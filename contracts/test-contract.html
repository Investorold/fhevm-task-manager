<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contract Test</title>
    <script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js"></script>
</head>
<body>
    <h1>TaskManager Contract Test</h1>
    <div id="results"></div>
    
    <script>
        async function testContract() {
            const resultsDiv = document.getElementById('results');
            
            try {
                // Contract details
                const contractAddress = '0x5e60a4e290DF0439384D9Fdb506DE601F9D4B038';
                const contractABI = [
                    "function taskCreationFee() external view returns (uint256)",
                    "function owner() external view returns (address)",
                    "function getTasks(address user) external view returns (tuple(euint64 title, euint64 dueDate, euint8 priority, uint8 status)[] memory)"
                ];
                
                // Check if MetaMask is available
                if (typeof window.ethereum !== 'undefined') {
                    resultsDiv.innerHTML += '<p>‚úÖ MetaMask detected</p>';
                    
                    // Request account access
                    const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                    resultsDiv.innerHTML += `<p>‚úÖ Connected to account: ${accounts[0]}</p>`;
                    
                    // Create provider and signer
                    const provider = new ethers.providers.Web3Provider(window.ethereum);
                    const signer = provider.getSigner();
                    
                    // Create contract instance
                    const contract = new ethers.Contract(contractAddress, contractABI, signer);
                    
                    // Test contract functions
                    try {
                        const fee = await contract.taskCreationFee();
                        resultsDiv.innerHTML += `<p style="color: green;">‚úÖ taskCreationFee(): ${ethers.utils.formatEther(fee)} ETH</p>`;
                    } catch (e) {
                        resultsDiv.innerHTML += `<p style="color: red;">‚ùå taskCreationFee() failed: ${e.message}</p>`;
                    }
                    
                    try {
                        const owner = await contract.owner();
                        resultsDiv.innerHTML += `<p style="color: green;">‚úÖ owner(): ${owner}</p>`;
                    } catch (e) {
                        resultsDiv.innerHTML += `<p style="color: red;">‚ùå owner() failed: ${e.message}</p>`;
                    }
                    
                    // Check network
                    const network = await provider.getNetwork();
                    resultsDiv.innerHTML += `<p>üåê Network: ${network.name} (Chain ID: ${network.chainId})</p>`;
                    
                    if (network.chainId !== 11155111) {
                        resultsDiv.innerHTML += `<p style="color: orange;">‚ö†Ô∏è Warning: Not connected to Sepolia! Please switch to Sepolia network.</p>`;
                    }
                    
                } else {
                    resultsDiv.innerHTML += '<p style="color: red;">‚ùå MetaMask not detected. Please install MetaMask.</p>';
                }
                
            } catch (error) {
                resultsDiv.innerHTML += `<p style="color: red;">‚ùå Error: ${error.message}</p>`;
            }
        }
        
        // Run test when page loads
        window.addEventListener('load', testContract);
    </script>
</body>
</html>
